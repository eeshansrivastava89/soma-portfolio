---
import PageLayout from '../layouts/BaseLayout.astro'
import { Icon } from 'astro-icon/components'

import { Image } from 'astro:assets'
import profile from '../assets/profile.jpg'

import fs from 'fs'
import yaml from 'js-yaml'
import path from 'path'

// Load social links
const socialLinksYaml = fs.readFileSync(
	path.join(process.cwd(), 'src/data/social-links.yaml'),
	'utf8'
)
const socialData = yaml.load(socialLinksYaml) as {
	socialLinks: Array<{ name: string; url: string; icon: string; label: string }>
}
const socialLinks = socialData.socialLinks

// Load build log data for stats
import buildLogData from '@/data/build-log-data.json'
const totalContributors = buildLogData.contributors?.length ?? 0
const openTasks = buildLogData.tasks?.filter((t: any) => t.status === 'open').length ?? 0

// Load projects
import { parseProjectsYaml } from '../../packages/shared/src/lib/projects'
import projectsYaml from '../../packages/shared/src/data/projects.yaml?raw'
import ProjectCard from '../../packages/shared/src/components/ProjectCard.astro'
const projects = parseProjectsYaml(projectsYaml)
---

<PageLayout meta={{ title: 'Home' }}>
	<div class='flex w-full flex-col'>
		
		<!-- ============================================ -->
		<!-- HERO: Compact horizontal card                -->
		<!-- ============================================ -->
		<section class='border border-border bg-primary-foreground p-6 shadow-lg shadow-black/5'>
			<div class='flex flex-col items-center gap-6 sm:flex-row sm:items-start'>
				<!-- Profile Image -->
				<Image
					src={profile}
					alt='profile photo'
					class='h-28 w-28 shrink-0 rounded-full bg-[#FFBE98] p-1.5'
					loading='eager'
				/>

				<!-- Name + Tagline + Socials -->
				<div class='flex flex-col items-center gap-4 sm:items-start'>
					<div class='text-center sm:text-left'>
						<h1 class='text-2xl font-bold sm:text-3xl'>Eeshan Srivastava</h1>
						<p class='mt-1 text-base text-muted-foreground'>
							Data science leader building products with AI
						</p>
					</div>

					<!-- Social Links + Newsletter -->
					<div class='flex flex-wrap items-center gap-x-3 gap-y-3'>
						{
							socialLinks.map((link) => (
								<a
									href={link.url}
									target='_blank'
									class='flex h-9 w-9 items-center justify-center rounded-full border border-border bg-background transition-all hover:bg-input'
									aria-label={link.label}
								>
									<Icon name={link.icon} class='h-4 w-4' />
								</a>
							))
						}
						<span class='text-muted-foreground'>|</span>
						<a
							href='https://scienceofexperimentation.substack.com'
							target='_blank'
							class='group flex items-center gap-2 text-sm'
						>
							<Icon name='simple-icons:substack' class='h-4 w-4 shrink-0' />
							<span class='text-muted-foreground'>Science of Experimentation & Analytics</span>
							<span class='font-medium text-foreground transition group-hover:translate-x-0.5'>Subscribe →</span>
						</a>
					</div>
				</div>
			</div>
		</section>

		<!-- ============================================ -->
		<!-- WHAT I'M BUILDING                            -->
		<!-- ============================================ -->
		<section class='mt-12 space-y-4'>
			<h2 class='text-2xl font-bold text-foreground'>What I'm Building</h2>
			
			<div class='space-y-3'>
				{projects.map((project) => (
					<ProjectCard project={project} variant='compact' />
				))}
			</div>
		</section>

		<!-- ============================================ -->
		<!-- JOIN THE BUILD                               -->
		<!-- ============================================ -->
		<section class='mt-16 border-t border-border/40 pt-12 space-y-4'>
			<h2 class='text-2xl font-bold text-foreground'>Join the Build</h2>
			
			<div class='flex flex-wrap items-center justify-between gap-4'>
				<div class='space-y-1'>
					<p class='text-sm text-muted-foreground'>Claim a task, open a PR, get code review, and ship. Real projects, real GitHub history.</p>
					<div class='flex items-center gap-4 pt-1 text-sm'>
						<span><span class='font-bold text-foreground'>{totalContributors}</span> <span class='text-muted-foreground'>contributors</span></span>
						<span><span class='font-bold text-foreground'>{openTasks}</span> <span class='text-muted-foreground'>open tasks</span></span>
					</div>
				</div>
				<a
					href='/contribute/'
					class='inline-flex shrink-0 items-center gap-2 bg-foreground px-4 py-2 text-sm font-semibold text-background shadow-sm transition hover:-translate-y-0.5 hover:bg-foreground/90'
				>
					See Open Tasks →
				</a>
			</div>
		</section>

	</div>
</PageLayout>
